# Hadoop MapReduce Financial
Apache Hadoop MapReduce task with financial csv-data Data Moscow State University Master's program

Формулировка задания:  На вход подается `.csv` файл (разделители – запятые) с финансовыми данными. 
Столбцы данного файла имеют следующие названия: 

 * `SYMBOL` – название финансового инструмента; 
 * `MOMENT` – время (дата); 
 * `PRICE_DEAL` – цена. 
     
Пример строки в файле: `SVH1,F,20110111100000080,255223067,30.46000,1,8714,S`

Обратите внимание, что колонки во входных файлах могут располагаться в разном порядке. Это необходимо учитывать в решении и корректно обрабатывать. Данный файл отсортирован по дате и времени. Дата и время указываются в формате `YYYYMMDDhhmmssfff`, где `f` – миллисекунды.

Внимание! Так как финансовые данные большого размера, отладку  программы  следует  производить  на  подвыборке  меньшего  размера: ` ./data/fin_sample.csv` ,   и  только убедившись, что все работает, запускать программу на данных большого размера.  

Вам необходимо: Привести данные к формату японских свечей, используя Hadoop MapReduce Java API. При этом, необходимо оптимизировать обработку данных с учетом ликвидности инструментов.


Каждая свеча – это:

 * `MOMENT` – время начала свечи;
 * `OPEN` – цена первой сделки за свечу;
 * `HIGH` – максимальная цена за свечу;
 * `LOW` – минимальная цена за свечу;
 * `CLOSE` – цена последней сделки за свечу.

Формат командной строки для запуска программы:
  `hadoop jar candle.jar candle -conf config.xml <Название входной директории> <Название выходной директории>`

Параметры программы должны содержаться в конфигурационном файле config.xml.
В программе должны использоваться следующие параметры со значениями по умолчанию:
  * `candle.width = 300000 ` -- "ширина" свечи в числе миллисекунд;
  * `candle.securities = ".*"` -- шаблон инструментов – задается в виде регулярного выражения;
  * `candle.date.from = 19000101` -- первый день периода времени (ГГГГММДД);
  * `candle.date.to = 20200101` -- первый день после последнего дня периода (ГГГГММДД);
  * `candle.time.from = 1000` -- время (ЧЧММ) начала первой свечи; 
  * `candle.time.to = 1800` -- время (ЧЧММ) после окончания последней свечи;
  * `candle.num.reducers = 1` -- число редьюсеров


Свечи "начинаются" в моменты времени, кратные "ширине". Отсчет времени для вычисления кратности начинается в 00:00 рассматриваемого дня.
На выходе необходимо получить директорию с файлами. Имена файлов должны содержать  SYMBOL в качестве префикса. Файлы для каждого `SYMBOL` должны быть отсортированы по `MOMENT` с учетом номера Reducer в имени файла.
Формат выходных данных (каждого файла) без шапки:
`SYMBOL,MOMENT,OPEN,HIGH,LOW,CLOSE`
Пример строки в выходном файле (обратите внимание, что точность определяется одним знаком после запятой):
`GDH1,20110111100000000,1407.0,1407.0,1379.0,1379.3`


Пояснение:
  * В ситуациях, когда рассматриваются записи, в которых совпадают названия инструментов и моменты времени, но цены различны, для разрешения неоднозначности необходимо дополнительно рассматривать поле `ID_DEAL`. При одинаковых моментах времени для цены открытия (`OPEN`) выбирается цена с наименьшим `ID_DEAL`, для цены закрытия (`CLOSE`) – с наибольшим `ID_DEAL`;
  * Свечи необходимо строить от `candle.time.from` до `candle.time.to` каждого рассматриваемого дня;
  * Рассматривать переход через сутки не нужно (программа будет тестироваться на свечах, построенных в рамках одного рабочего дня, `10:00 – 18:00`, либо меньшего периода времени);
  * Рассматривать случай, когда последняя свеча не залезает целиком в рассматриваемый промежуток времени, не нужно (считаем, что в рассматриваемый период времени укладывается целое число свеч, и в момент времени `candle.time.to` должна начаться новая свеча, которую мы не рассматриваем); 
  * Рассматривать случай, когда `candle.time.from` не кратно размеру свечи, не нужно. Считаем, что `candle.time.from` всегда кратно размеру свечи.

